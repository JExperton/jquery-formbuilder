var Formrunner=function(e){if("object"!=typeof e.targets||0===e.targets.length)throw new Error("Invalid or missing target element(s)");var t={form_id:!1,model:!1,targets:!1,action:"",method:"POST",lang:"en",templateBasePath:"templates/runner"},r=this;return this._opts=$.extend(!0,{},t,e),void 0===dust.onLoad&&(dust.onLoad=function(e,t){$.ajax(r._opts.templateBasePath+"/"+r._opts.lang+"_"+e+".tpl",{success:function(e){t(void 0,e)},error:function(e,r){t(r,void 0)}})}),this.render(),this},sortObject=function(e){var t=[];for(var r in e)e.hasOwnProperty(r)&&t.push({key:r,value:e[r].sortOrder});t.sort(function(e,t){return e.value-t.value});for(var o=[],n=0,a=t.length;a>n;n++){var d=t[n].key;o.push(e[d])}return o};Formrunner.prototype={_opts:!1,render:function(){var e=this,t={form_id:e._opts.form_id,action:e._opts.action,method:e._opts.method};dust.render("base",t,function(t,r){var o=$(r).appendTo(e._opts.targets),n=o.find(".fields-wrapper");0==n.length&&(n=$("<div>",{"class":"fields-wrapper"}).prependTo(o));var a=sortObject(e._opts.model);$.each(a,function(t,r){e.appendElementForModel(r,n)})})},appendElementForModel:function(e,t){var r=this,o={id:r.fieldNameToId(e.label),label:e.label,required:e.required};dust.render(e.type,o,function(o,n){var a=$(n).appendTo(t);void 0!==e.choices&&e.choices.length>0&&$.each(e.choices,function(t,o){o.id=r.fieldNameToId(o.label),o.name=r.fieldNameToId(e.label),dust.render(e.type+"-choices",o,function(t,r){"select"===e.type?a.find("select").append(r):a.find(".frmb-choices").append(r)})})})},fieldNameToId:function(e){return e.toLowerCase().replace(/ /g,"-").replace(/[^a-zA-Z0-9_.-]/g,"")}};