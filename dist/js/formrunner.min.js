var formrunner=function(e){if("object"!=typeof e.targets||0===e.targets.length)throw new Error("Invalid or missing target element(s)");var t={form_id:!1,model:!1,targets:!1,action:"",method:"POST",lang:"en",templateBasePath:"templates/runner"},o=this;return this._opts=$.extend(!0,{},t,e),void 0===dust.onLoad&&(dust.onLoad=function(e,t){$.ajax(o._opts.templateBasePath+"/"+o._opts.lang+"_"+e+".tpl",{success:function(e){t(void 0,e)},error:function(e,o){t(o,void 0)}})}),this.render(),this},sortObject=function(e){var t=[];for(var o in e)e.hasOwnProperty(o)&&t.push({key:o,value:e[o].sortOrder});t.sort(function(e,t){return e.value-t.value});for(var r=[],n=0,a=t.length;a>n;n++){var i=t[n].key;r.push(e[i])}return r};formrunner.prototype={_opts:!1,render:function(){var e=this,t={form_id:e._opts.form_id,action:e._opts.action,method:e._opts.method};dust.render("base",t,function(t,o){e._opts.targets.append(o);var r=sortObject(e._opts.model);$.each(r,function(t,o){e.appendElementForModel(o)})})},appendElementForModel:function(e){var t=this,o={id:t.fieldNameToId(e.label),label:e.label,required:e.required};dust.render(e.type,o,function(o,r){t._opts.targets.find("form>ul").append(r);var n=t._opts.targets.find("form>ul>li:last-child");void 0!==e.choices&&e.choices.length>0&&$.each(e.choices,function(o,r){r.id=t.fieldNameToId(r.label),r.name=t.fieldNameToId(e.label),dust.render(e.type+"-choices",r,function(t,o){"select"===e.type?n.find("select").append(o):n.find(".frmb-choices").append(o)})})})},fieldNameToId:function(e){return e.toLowerCase().replace(/ /g,"-").replace(/[^a-zA-Z0-9_.-]/g,"")}};